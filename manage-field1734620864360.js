import{d as il,i as sl,r as _,c as M,s as nl,v as X,G as rl,o as ul,a as A,w as u,u as l,H as dl,b as cl,e as m,f as i,l as Ae,g,I as ge,J as Ee,h as T,j as se,k as be,F as Oe,q as L,Q as p,p as ne,t as z,E as vl,K as ye,D as fl,R as ml}from"./index1734620864360.js";import{f as pl,V as s,b as _e,F as $,c as N,v as Cl,_ as q,J as Al,e as Le,h as gl,i as El}from"./index17346208643602.js";import{a as re,Q as ue,b as bl,c as Ol}from"./q-table-column.builder1734620864360.js";import{Q as yl}from"./QForm1734620864360.js";import{f as c,u as _l,F as Ll}from"./field.data1734620864360.js";import{_ as h}from"./header-component.vue_vue_type_style_index_0_lang1734620864360.js";import{a as R}from"./field.service1734620864360.js";import{d as Rl}from"./endoresement.data1734620864360.js";var de=(w=>(w.SOMA="SOMA",w.SUBTRACAO="SUBTRACAO",w))(de||{});const ce={SOMA:"Soma",SUBTRACAO:"Subtração"},Re=Object.keys(de).map(w=>{const j=de[w];return{descricao:ce[j],valor:j}}),Vl={class:"row q-mb-md"},Tl={class:"row"},Ul={class:"bg-grey-4 q-pa-sm"},Il={class:"row"},Fl={key:0,class:"row q-gutter-md justify-end q-mr-md q-mt-sm q-mb-lg"},Dl=["textContent"],kl={class:"row col-12"},wl={class:"row q-gutter-md full-width justify-end"},xl=["textContent"],Nl={class:"row col-12"},ql={class:"row q-gutter-md full-width justify-end"},hl=["textContent"],Sl={class:"col flex justify-end q-gutter-md q-mt-lg q-mr-md"},Gl=il({__name:"manage-field",setup(w){const j=dl(),ve=cl(),{sub_title:Ve,title:Te}=ve.meta,{t:o}=sl.global,Ue=c.formatListItems(pl),U=_(void 0),v=_({}),d=_({}),C=_({}),b=_([]),Z=_([]),Ie=_([]),Y=_([]),x=ve.params.id,S=_l(),H=_([]),ee=_(!1),{resetForm:Fe,setFieldValue:fe,validateFn:De,setValues:ke}=S,we=M(()=>c.createMaks(I.value,n.value==s.PADRAO?"ALFANUMERICO":"NUMERICO")),le=M(()=>{var t;return n.value==s.PADRAO&&!!((t=V.value)!=null&&t.length)&&V.value.length>0&&v.value.indexEdit===void 0}),xe=M(()=>{if(!I.value)return"É necessário cadastrar a quantidade de caracteres"}),{nome:G,nomeAttrs:Ne,descricao:J,descricaoAttrs:qe,ordem:K,ordemAttrs:he,tipo:E,tipoAttrs:Se,tipoValor:n,tipoValorAttrs:Be,quantidadeCaracteres:I,quantidadeCaracteresAttrs:Qe,errors:F,obrigatorio:ae,obrigatorioAttrs:Pe,destaque:te,destaqueAttrs:Me,maxNumberInOrder:oe,valores:V,calculos:D,averbacoes:B}=nl(S);function Q(t,e,a){const r=e.find(f=>f[a]==t);return(r==null?void 0:r.descricao)??t}const ie=M(()=>{const t=new bl;return n.value===s.CALCULO&&t.create_column("campoDoValor",o("message.field"),!1,e=>Q(e,b.value,"valor")).create_column("idValor",o("message.fieldValue"),!1,e=>Q(e,Z.value,"valor")).create_column("calculo",o("message.typeOfCalculation"),!1,e=>ce[e]??e).create_column("campoCalculado",o("message.fieldToCalculation"),!1,e=>Q(e,b.value,"valor")),n.value===s.CALCULO_AVERBACAO&&t.create_column("idAverbacao","Averbação",!1,e=>Q(e,Y.value,"valor")).create_column("campoCalculado",o("message.fieldToCalculation"),!1,e=>Q(e,b.value,"valor")).create_column("calculo",o("message.typeOfCalculation"),!1,e=>ce[e]??e),[s.PADRAO,s.SELECAO].includes(n.value)&&t.create_column("valor",o("message.value")).create_column("descricao",o("message.description")),t.build(!0)}),ze=M(()=>Object.keys(_e).reduce((t,e)=>{const{group:a,label:r}=_e[e];t[a]||(t[a]=[]);const O={NOME_ARQUIVO:![s.PADRAO,s.REFERENCIA,s.DATA_SISTEMA,s.HORA_SISTEMA,s.QUANTIDADE_LOTE,s.QUANTIDADE_LINHA].includes(e),HEADER_ARQUIVO:[s.REFERENCIA,s.CALCULO,s.CALCULO_AVERBACAO].includes(e),TRAILER_ARQUIVO:[s.REFERENCIA,s.CALCULO,s.CALCULO_AVERBACAO].includes(e),HEADER_LOTE:[s.CALCULO_AVERBACAO].includes(e),TRAILER_LOTE:[s.CALCULO_AVERBACAO].includes(e),CONTEUDO_LOTE:[s.CALCULO_AVERBACAO].includes(e),ESPECIFICACAO:s.CALCULO_AVERBACAO!==e}[E.value]??!0;return t[a].push({descricao:r,value:e,disable:O}),t},{})),$e=[{header:0,title:o(x?"message.edit":"message.create"),openItem:!0,expandItem:!0,havePermission:!0}],me=async t=>await c.getMaxNumberInOrder(t).then(e=>e?e+1:1);X(()=>d.value.field,async t=>{if(!t)return;const e=await Ll.getFieldValuesByFieldId(t);Z.value=e.map(a=>({valor:a.id,descricao:a.descricao}))},{deep:!0}),rl(async()=>{if(![s.CALCULO,s.CALCULO_AVERBACAO].includes(n.value))return;const t=await c.getFieldsByCategory("LINHA");b.value=t.map(e=>({valor:e.id,descricao:e.nome}))});const pe=async(t,e)=>{if(e!==s.REFERENCIA)return;const a=await c.getFieldsByCategory(t===$.CONTEUDO_LOTE?"LOTE":"ARQUIVO");H.value=c.formatToListTValor(a,"id","nome","tipo")};X(E,async t=>{if(x)return;if(!t){oe.value=1,fe("ordem",void 0);return}const e=await me(t);if(oe.value=e,fe("ordem",e),n.value=void 0,t===$.ESPECIFICACAO){ee.value=!0,n.value=s.CALCULO_AVERBACAO;return}ee.value=!1,n.value===s.CALCULO&&![$.HEADER_LOTE,$.TRAILER_LOTE].includes(t)&&S.resetField("tipoValor"),n.value&&await pe(t,n.value)}),X(n,async t=>{t&&(t!==s.CALCULO&&S.resetField("calculos"),[s.PADRAO,s.SELECAO].includes(t)||S.resetField("valores"),U.value=void 0,!H.value.length&&await pe(E.value,t))}),X(v.value,async({valor:t})=>{n.value===s.REFERENCIA&&(v.value=H.value.find(e=>e.valor===t)||{},Ce())},{deep:!0});function Ce(){var r,f,O;const{descricao:t,indexEdit:e,valor:a}=v.value;if(!t||!a){c.createNotify(o("message.invalid_form"),"warning");return}if((r=V.value)!=null&&r.some(({valor:y})=>y===v.value.valor)&&e===void 0){c.createNotify(o("message.this_value_already_exists"),"warning");return}e===void 0&&((f=V.value)==null||f.push({descricao:t,valor:a})),e!==void 0&&((O=V.value)==null||O.splice(e,1,{descricao:t,valor:a})),v.value={}}function je(){var k,P,W;const{indexEdit:t,fieldToCalculation:e,field:a,fieldValue:r,typeOfCalculation:f}=d.value;if(!a||!r||!f||!e){c.createNotify(o("message.invalid_form"),"warning");return}if((((k=D.value)==null?void 0:k.some(({idValor:ll,campoCalculado:al})=>{const tl=ll.toString()===d.value.fieldValue,ol=al===d.value.fieldToCalculation;return tl&&ol}))??!1)&&t===void 0){c.createNotify(o("message.this_value_already_exists"),"warning");return}const y={campoDoValor:a,idValor:parseInt(r),calculo:f,campoCalculado:e};t===void 0&&((P=D.value)==null||P.push(y)),t!==void 0&&((W=D.value)==null||W.splice(t,1,y)),d.value={}}function He(){var y,k,P;const{indexEdit:t,fieldToCalculation:e,idEndorsement:a,typeOfCalculation:r}=C.value;if(!a||!r||!e){c.createNotify(o("message.invalid_form"),"warning");return}if((((y=B.value)==null?void 0:y.some(({campoCalculado:W})=>W===C.value.fieldToCalculation))??!1)&&t===void 0){c.createNotify(o("message.this_value_already_exists"),"warning");return}const O={idAverbacao:a,calculo:r,campoCalculado:e};t===void 0&&((k=B.value)==null||k.push(O)),t!==void 0&&((P=B.value)==null||P.splice(t,1,O)),C.value={}}const Ge=(t,e)=>{d.value={indexEdit:e,field:t.campoDoValor,fieldValue:t.idValor,typeOfCalculation:t.calculo,fieldToCalculation:t.campoCalculado}},Je=(t,e)=>{C.value={indexEdit:e,idEndorsement:t.idAverbacao,typeOfCalculation:t.calculo,fieldToCalculation:t.campoCalculado}};function Ke(t){const e=()=>{var a;return(a=V.value)==null?void 0:a.splice(t,1)};c.confirmDialog(e)}function We(t){const e=()=>{var a;return(a=D.value)==null?void 0:a.splice(t,1)};c.confirmDialog(e)}function Xe(t){const e=()=>{var a;return(a=B.value)==null?void 0:a.splice(t,1)};c.confirmDialog(e)}const Ze=()=>{j.go(-1),Fe()},Ye=()=>{De().then(({valores:t,...e})=>{const a=e.tipoValor===s.REFERENCIA&&U.value,r={...e,valores:a?[{campoReferencia:U.value}]:t};if(x){c.updateField(r);return}c.saveField(r)})};async function el(){await Rl.getEndoresementList().then(t=>Y.value=t)}return ul(async()=>{if(await el(),!x)return;const t=await c.getFieldById(x);ke(t),E.value&&(oe.value=await me(E.value)),D.value&&n.value===s.CALCULO&&(Ie.value=await c.getFieldValuesListByFieldIdsList(D.value.map(({campoDoValor:e})=>e))),n.value===s.REFERENCIA&&V.value&&(U.value=parseInt(t.valores[0].campoReferencia))}),(t,e)=>(m(),A(l(Al),{container:$e,title:l(Te),"sub-title":l(Ve)},{section0:u(()=>[i(vl,null,{default:u(()=>[i(yl,{greedy:"",onSubmit:Ae(Ye,["prevent"])},{default:u(()=>[g("div",Vl,[i(ge,Ee({modelValue:l(ae),"onUpdate:modelValue":e[0]||(e[0]=a=>T(ae)?ae.value=a:null),color:"primary",style:{"margin-left":"18px"},class:"text-grey-8 q-mr-lg",label:"Obrigatório"},l(Pe)),null,16,["modelValue"]),i(ge,Ee({disable:l(E)!==l($).CONTEUDO_LOTE,modelValue:l(te),"onUpdate:modelValue":e[1]||(e[1]=a=>T(te)?te.value=a:null),color:"primary",class:"text-grey-8",label:"Destaque"},l(Me)),null,16,["disable","modelValue"])]),g("div",Tl,[i(N,{input:{field:l(G),nome:l(o)("message.fieldNameLabel"),fieldAttrs:l(Ne),obrigatorio:!0},event:l(G),"onUpdate:event":e[2]||(e[2]=a=>T(G)?G.value=a:null),errors:l(F).nome},null,8,["input","event","errors"]),i(N,{input:{field:l(J),nome:l(o)("message.fieldDescriptionLabel"),fieldAttrs:l(qe),obrigatorio:!0},event:l(J),"onUpdate:event":e[3]||(e[3]=a=>T(J)?J.value=a:null),errors:l(F).descricao},null,8,["input","event","errors"]),i(R,{input:{valores:l(Ue),field:l(E),nome:l(o)("message.fieldTypeLabel"),fieldAttrs:l(Se),obrigatorio:!0,proibido:!!l(x)},event:l(E),"onUpdate:event":e[4]||(e[4]=a=>T(E)?E.value=a:null),errors:l(F).tipo},null,8,["input","event","errors"]),i(N,{input:{field:l(K),nome:l(o)("message.fieldOrderInListLabel"),fieldAttrs:l(he),obrigatorio:!0,proibido:!l(E),mask:"###"},event:l(K),"onUpdate:event":e[5]||(e[5]=a=>T(K)?K.value=a:null),errors:l(F).ordem},null,8,["input","event","errors"]),i(R,{input:{valores:[ze.value],field:l(Cl)[l(n)],nome:l(o)("message.fieldTypeValueLabel"),fieldAttrs:l(Be),obrigatorio:!0,proibido:ee.value},"custon-select":!0,event:l(n),"onUpdate:event":e[6]||(e[6]=a=>T(n)?n.value=a:null),errors:l(F).tipoValor},{default:u(({slot:a})=>[(m(!0),se(Oe,null,be(a,(r,f)=>(m(),A(Ol,{bordered:"",separator:""},{default:u(()=>[g("div",Ul,[i(Le,null,{default:u(()=>[ye(z(l(gl)[f]),1)]),_:2},1024)]),(m(!0),se(Oe,null,be(r,({value:O,disable:y,descricao:k})=>fl((m(),A(El,{disable:y,readonly:y,clickable:"",onClick:()=>n.value=O},{default:u(()=>[i(Le,null,{default:u(()=>[ye(z(k),1)]),_:2},1024)]),_:2},1032,["disable","readonly","onClick"])),[[ml]])),256))]),_:2},1024))),256))]),_:1},8,["input","event","errors"]),i(N,{input:{field:l(I),nome:l(o)("message.fieldCharsQuantityLabel"),fieldAttrs:l(Qe),obrigatorio:!0,mask:"##"},event:l(I),"onUpdate:event":e[7]||(e[7]=a=>T(I)?I.value=a:null),errors:l(F).quantidadeCaracteres},null,8,["input","event","errors"]),l(n)===l(s).REFERENCIA?(m(),A(R,{key:0,input:{valores:H.value,field:U.value,nome:l(o)("message.field"),obrigatorio:!0},event:U.value,"onUpdate:event":e[8]||(e[8]=a=>U.value=a),errors:l(F).tipo},null,8,["input","event","errors"])):L("",!0)]),l(n)==l(s).SELECAO||l(n)==l(s).PADRAO?(m(),A(h,{key:0,title:"Valores",class:"q-mx-md","header-highlights":""},{slot:u(()=>[g("div",Il,[l(n)==l(s).SELECAO||l(n)==l(s).PADRAO?(m(),A(N,{key:0,input:{field:v.value.valor,nome:l(o)("message.value"),fieldAttrs:null,obrigatorio:!0,mask:we.value,proibido:!l(I)||le.value},errors:xe.value,event:v.value.valor,"onUpdate:event":e[9]||(e[9]=a=>v.value.valor=a)},null,8,["input","errors","event"])):L("",!0),l(n)==l(s).SELECAO||l(n)==l(s).PADRAO?(m(),A(N,{key:1,input:{field:v.value.descricao,nome:l(o)("message.descriptionValue"),fieldAttrs:null,obrigatorio:!0,proibido:le.value},event:v.value.descricao,"onUpdate:event":e[10]||(e[10]=a=>v.value.descricao=a)},null,8,["input","event"])):L("",!0)]),l(n)==l(s).SELECAO||l(n)==l(s).PADRAO?(m(),se("div",Fl,[v.value.indexEdit!=null?(m(),A(p,{key:0,label:l(o)("message.cancel"),color:"grey-8",onClick:e[11]||(e[11]=()=>v.value={})},null,8,["label"])):L("",!0),i(p,{color:"primary",disable:le.value,onClick:Ce},{default:u(()=>[i(ne,{name:"fa-solid fa-plus",left:"",size:"xs"}),g("span",{textContent:z(v.value.indexEdit==null?l(o)("message.add"):l(o)("message.change"))},null,8,Dl)]),_:1},8,["disable"])])):L("",!0),i(h,{title:"Dados",class:"q-mx-md"},{slot:u(()=>[i(re,{flat:"",rows:l(V)??[],columns:ie.value,"rows-per-page-options":[5,10,15,20,25,50],"row-key":"valor"},{"body-cell-action":u(({row:a,rowIndex:r})=>[i(ue,{"auto-width":""},{default:u(()=>[i(p,{icon:"fa-solid fa-pen",flat:"",size:"sm",round:"",color:"grey-8",onClick:()=>v.value={indexEdit:r,...a}},{default:u(()=>[i(q,{data:l(o)("message.edit")},null,8,["data"])]),_:2},1032,["onClick"]),i(p,{icon:"fa-solid fa-trash",flat:"",size:"sm",round:"",color:"grey-8",onClick:f=>Ke(r),disable:v.value.indexEdit===r},{default:u(()=>[i(q,{data:l(o)("message.delete")},null,8,["data"])]),_:2},1032,["onClick","disable"])]),_:2},1024)]),_:1},8,["rows","columns"])]),_:1})]),_:1})):L("",!0),l(n)==l(s).CALCULO?(m(),A(h,{key:1,title:"Valores",class:"q-my-md","header-highlights":""},{slot:u(()=>[g("div",kl,[i(R,{input:{valores:b.value,field:d.value.field,nome:l(o)("message.field"),fieldAttrs:null,obrigatorio:!0,proibido:b.value.length===0},event:d.value.field,"onUpdate:event":e[12]||(e[12]=a=>d.value.field=a)},null,8,["input","event"]),i(R,{input:{valores:Z.value,field:d.value.fieldValue,nome:l(o)("message.fieldValue"),fieldAttrs:null,obrigatorio:!0,proibido:!d.value.field},event:d.value.fieldValue,"onUpdate:event":e[13]||(e[13]=a=>d.value.fieldValue=a)},null,8,["input","event"]),i(R,{input:{valores:b.value,field:d.value.fieldToCalculation,nome:l(o)("message.fieldToCalculation"),fieldAttrs:null,obrigatorio:!0,proibido:b.value.length===0},event:d.value.fieldToCalculation,"onUpdate:event":e[14]||(e[14]=a=>d.value.fieldToCalculation=a)},null,8,["input","event"]),i(R,{input:{valores:l(Re),field:d.value.typeOfCalculation,nome:l(o)("message.typeOfCalculation"),fieldAttrs:null,obrigatorio:!0},event:d.value.typeOfCalculation,"onUpdate:event":e[15]||(e[15]=a=>d.value.typeOfCalculation=a)},null,8,["input","event"])]),g("div",wl,[d.value.indexEdit!=null?(m(),A(p,{key:0,label:l(o)("message.cancel"),color:"grey-8",onClick:e[16]||(e[16]=()=>d.value={})},null,8,["label"])):L("",!0),i(p,{color:"primary",onClick:je},{default:u(()=>[i(ne,{name:"fa-solid fa-plus",left:"",size:"xs"}),g("span",{textContent:z(d.value.indexEdit==null?l(o)("message.add"):l(o)("message.change"))},null,8,xl)]),_:1})]),i(h,{title:"Dados",class:"q-my-md"},{slot:u(()=>[i(re,{flat:"",rows:l(D)??[],columns:ie.value,"rows-per-page-options":[5,10,15,20,25,50]},{"body-cell-action":u(({row:a,rowIndex:r})=>[i(ue,{key:"action","auto-width":""},{default:u(()=>[i(p,{icon:"fa-solid fa-pen",flat:"",size:"sm",round:"",color:"grey-8",onClick:f=>Ge(a,r)},{default:u(()=>[i(q,{data:l(o)("message.edit")},null,8,["data"])]),_:2},1032,["onClick"]),i(p,{icon:"fa-solid fa-trash",flat:"",size:"sm",round:"",color:"grey-8",onClick:f=>We(r),disable:d.value.indexEdit===r},{default:u(()=>[i(q,{data:l(o)("message.delete")},null,8,["data"])]),_:2},1032,["onClick","disable"])]),_:2},1024)]),_:1},8,["rows","columns"])]),_:1})]),_:1})):L("",!0),l(n)==l(s).CALCULO_AVERBACAO?(m(),A(h,{key:2,title:"Valores",class:"q-my-md","header-highlights":""},{slot:u(()=>[g("div",Nl,[i(R,{input:{valores:Y.value,field:C.value.idEndorsement,nome:"Averbação",fieldAttrs:null,obrigatorio:!0},event:C.value.idEndorsement,"onUpdate:event":e[17]||(e[17]=a=>C.value.idEndorsement=a)},null,8,["input","event"]),i(R,{input:{valores:b.value,field:C.value.fieldToCalculation,nome:l(o)("message.fieldToCalculation"),fieldAttrs:null,obrigatorio:!0,proibido:b.value.length===0},event:C.value.fieldToCalculation,"onUpdate:event":e[18]||(e[18]=a=>C.value.fieldToCalculation=a)},null,8,["input","event"]),i(R,{input:{valores:l(Re),field:C.value.typeOfCalculation,nome:l(o)("message.typeOfCalculation"),fieldAttrs:null,obrigatorio:!0},event:C.value.typeOfCalculation,"onUpdate:event":e[19]||(e[19]=a=>C.value.typeOfCalculation=a)},null,8,["input","event"])]),g("div",ql,[d.value.indexEdit!=null?(m(),A(p,{key:0,label:l(o)("message.cancel"),color:"grey-8",onClick:e[20]||(e[20]=()=>d.value={})},null,8,["label"])):L("",!0),i(p,{color:"primary",onClick:He},{default:u(()=>[i(ne,{name:"fa-solid fa-plus",left:"",size:"xs"}),g("span",{textContent:z(d.value.indexEdit==null?l(o)("message.add"):l(o)("message.change"))},null,8,hl)]),_:1})]),i(h,{title:"Dados",class:"q-my-md"},{slot:u(()=>[i(re,{flat:"",rows:l(B)??[],columns:ie.value,"rows-per-page-options":[5,10,15,20,25,50]},{"body-cell-action":u(({row:a,rowIndex:r})=>[i(ue,{key:"action","auto-width":""},{default:u(()=>[i(p,{icon:"fa-solid fa-pen",flat:"",size:"sm",round:"",color:"grey-8",onClick:f=>Je(a,r)},{default:u(()=>[i(q,{data:l(o)("message.edit")},null,8,["data"])]),_:2},1032,["onClick"]),i(p,{icon:"fa-solid fa-trash",flat:"",size:"sm",round:"",color:"grey-8",onClick:f=>Xe(r),disable:d.value.indexEdit===r},{default:u(()=>[i(q,{data:l(o)("message.delete")},null,8,["data"])]),_:2},1032,["onClick","disable"])]),_:2},1024)]),_:1},8,["rows","columns"])]),_:1})]),_:1})):L("",!0),g("div",Sl,[i(p,{label:l(o)("message.cancel"),color:"grey-8",onClick:Ae(Ze,["prevent"])},null,8,["label"]),i(p,{label:l(o)("message.confirm"),color:"primary",type:"submit"},null,8,["label"])])]),_:1})]),_:1})]),_:1},8,["title","sub-title"]))}});export{Gl as default};
