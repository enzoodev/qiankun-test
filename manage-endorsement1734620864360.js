import{i as D,B as H,M as Z,N as K,d as O,s as W,r as f,c as X,v as Y,Z as ee,o as ae,a as se,w as r,u as n,b as te,e as oe,f as t,l as k,g as b,h as ne,E as C,Q as h,p as le,t as re}from"./index1734620864360.js";import{b as ie,a as ue,Q as ce}from"./q-table-column.builder1734620864360.js";import{Q as me}from"./QForm1734620864360.js";import{d as de,c as fe,_ as ve,J as pe}from"./index17346208643602.js";import{u as ge,a as E}from"./field.service1734620864360.js";import{_ as I}from"./header-component.vue_vue_type_style_index_0_lang1734620864360.js";import{f as _e,F as be}from"./field.data1734620864360.js";import{d as i}from"./endoresement.data1734620864360.js";const{t:Q}=D.global,N=H("endorsement-manage-form-store",()=>{const y=Z().shape({nome:K().required().label(Q("message.endorsementType"))}),{defineField:v,setFieldValue:p,resetForm:g,validate:o,setValues:u,errors:m,values:w}=ge({validationSchema:y}),[F]=v("nome");return{nome:F,validateFn:async()=>{const{valid:l}=await o({mode:"force"});if(l)return w;throw de.createNotify(Q("message.invalid_form"),"warning"),new Error(Q("message.invalid_form"))},values:w,errors:m,setValues:u,resetForm:g,setFieldValue:p}});function ye(y){return y.sort((v,p)=>{const g=parseInt(v.descricao.split(" ")[0]),o=parseInt(p.descricao.split(" ")[0]);return g-o})}const we={class:"row items-center"},he={class:"row items-center"},Fe={class:"flex justify-end"},Be=["textContent"],Ve={class:"col flex justify-end q-mr-md q-mb-sm q-mt-lg"},Ie=O({__name:"manage-endorsement",setup(y){const v=te(),{sub_title:p,title:g}=v.meta,{t:o}=D.global,u=v.params.id,{nome:m,errors:w}=W(N()),{validateFn:F,resetForm:B}=N(),l=f(),c=f([]),V=f([]),_=f([]),T=f([]),d=f(),x=f(!1),L=X(()=>!!u),S=[{header:0,title:o(u?"message.edit":"message.create"),openItem:!1,expandItem:!0,havePermission:!0}],R=new ie().create_column("nome",o("message.field")).create_column("descricaoValor",o("message.fieldValue")).build(!0);async function j(){if(u){const a=await i.getEndoresementById(u);m.value=a.nome,c.value=[...a.campos],T.value=[...a.campos]}}Y(l,async a=>{if(!a){_.value=[];return}_.value=await be.getFieldValuesByFieldId(a).then(e=>i.formatToListTValor(e,"id","valor","descricao")).then(ye)});function A(){if(!l.value||!d.value){i.createNotify(o("message.invalid_form"));return}if(c.value.some(({campo:s})=>s===l.value)){i.createNotify("Este campo já foi selecionado!");return}const a=V.value.find(({valor:s})=>s===l.value).descricao,e=_.value.find(({valor:s})=>s===d.value);c.value.unshift({nome:a,descricaoValor:e.descricao,valor:e.valor,campo:l.value,idValor:d.value}),l.value=null,d.value=null,x.value=!0}function M(){if(x.value){i.confirmDialog(()=>c.value=[...T.value],{message:"Ao cancelar, todas as suas alterações serão perdidas. Gostaria de continuar?"}),x.value=!1;return}q()}function U(a){c.value.splice(a,1)}const q=()=>{i.goBack(),B()};function z(){if(c.value.length===0){i.createNotify(o("message.add_at_least_one_field"),"negative");return}const a={campos:c.value.map(({id:e,campo:s,nome:$,idValor:G,valor:J,descricaoValor:P})=>({id:e,campo:s,nome:$,idValor:G,valor:J,descricaoValor:P}))};F().then(e=>{if(u){i.putEndoresement({...e,...a},u).then(()=>q());return}i.createEndoresement({...e,...a}).then(()=>q())})}return ee((a,e,s)=>{B(),s()}),ae(async()=>{await j(),V.value=await _e.getFieldsByCategory("LINHA").then(a=>i.formatToListTValor(a,"id","nome"))}),(a,e)=>(oe(),se(n(pe),{container:S,title:n(g),"sub-title":n(p)},{section0:r(()=>[t(C,null,{default:r(()=>[t(me,{greedy:"",onSubmit:k(A,["prevent"])},{default:r(()=>[b("div",we,[t(fe,{class:"col-md-2 col-sm-6 col-xs-12 q-mb-lg",event:n(m),"onUpdate:event":e[0]||(e[0]=s=>ne(m)?m.value=s:null),errors:n(w).nome,input:{field:n(m),nome:n(o)("message.endorsementType"),obrigatorio:!0,proibido:L.value}},null,8,["event","errors","input"])]),t(I,{class:"q-mx-md",title:"Valores"},{slot:r(()=>[t(C,null,{default:r(()=>[b("div",he,[t(E,{class:"col-md-2 col-sm-6 col-xs-12 q-mt-sm",event:l.value,"onUpdate:event":e[1]||(e[1]=s=>l.value=s),input:{valores:V.value,field:l.value,nome:n(o)("message.field"),obrigatorio:!0}},null,8,["event","input"]),t(E,{class:"col-md-2 col-sm-6 col-xs-12 q-mt-sm",event:d.value,"onUpdate:event":e[2]||(e[2]=s=>d.value=s),input:{valores:_.value,field:d.value,nome:n(o)("message.fieldValue"),obrigatorio:!0,proibido:_.value.length<=0}},null,8,["event","input"])]),b("div",Fe,[t(h,{class:"justify-end q-mr-md q-mb-lg",color:"primary",type:"submit"},{default:r(()=>[t(le,{name:"fa-solid fa-plus",left:"",size:"xs"}),b("span",{textContent:re(n(o)("message.add"))},null,8,Be)]),_:1})])]),_:1}),t(I,{class:"q-mx-md",title:"Listagem"},{slot:r(()=>[t(C,null,{default:r(()=>[t(ue,{columns:n(R),rows:c.value,"rows-per-page-options":[5,10,15,20,25,50],class:"shadow-0"},{"body-cell-action":r(({rowIndex:s})=>[t(ce,{"auto-width":""},{default:r(()=>[t(h,{icon:"fa-solid fa-trash",flat:"",size:"sm",round:"",color:"grey-8",onClick:$=>U(s)},{default:r(()=>[t(ve,{data:a.$t("message.remove")},null,8,["data"])]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["columns","rows"])]),_:1})]),_:1}),b("div",Ve,[t(h,{label:n(o)("message.cancel"),class:"q-mr-md",color:"grey-8",onClick:e[3]||(e[3]=k(s=>M(),["prevent"]))},null,8,["label"]),t(h,{label:n(o)("message.confirm"),color:"primary",onClick:z},null,8,["label"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["title","sub-title"]))}});export{Ie as default};
