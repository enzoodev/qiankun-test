import{d as ce,r as b,s as fe,i as ve,c,n as _e,v as pe,o as ge,a as h,w as l,u as o,b as be,e as u,f as s,Q as f,g as v,j as y,k as U,F as z,q as C,p as M,t as P,l as he,x as Q,m as j}from"./index1734620864360.js";import{Q as ye}from"./QForm1734620864360.js";import{b as we,_ as Ce,d as qe}from"./depe.data1734620864360.js";import{form_store_line as _}from"./form_line_store1734620864360.js";import{_ as J}from"./header-component.vue_vue_type_style_index_0_lang1734620864360.js";import{_ as H,J as ke}from"./index17346208643602.js";import{_ as O,R as $e}from"./release.model1734620864360.js";import{m as G,a as De}from"./field.service1734620864360.js";import{d as K}from"./endoresement.data1734620864360.js";import{t as xe}from"./table.data1734620864360.js";import{d as n}from"./file.data1734620864360.js";import"./q-table-column.builder1734620864360.js";import"./pagination-store.util1734620864360.js";import"./form-store.util1734620864360.js";import"./rule-enum1734620864360.js";const Le={class:"row full-width"},Te={class:"row q-mt-md"},Ae={class:"row q-mt-md"},Fe={key:0,class:"flex justify-end q-gutter-x-xs q-mt-lg"},Ve=["textContent"],Be={key:0,class:"flex justify-end q-gutter-md q-mb-lg"},Re=["textContent"],Ie={class:"flex justify-end q-gutter-md q-mb-lg"},Ye=ce({__name:"manage-line",setup(Se){const $=be(),q=$.params.id,V=$.params.idFile,{sub_title:W,title:X}=$.meta,B=b([]),i=b(),R=b([]),I=b([]),S=b([]),p=b(25),r=fe(_()),{validateFn:Y,filling:Z,setValues:ee,resetForm:E,resetFields:N}=_(),g=we(),{t:k}=ve.global,te=c(()=>i.value?k("message.invalid_form_line_edit"):k("message.invalid_form_line_created")),D=c(()=>!!_().fields.length),ae=c(()=>G().getComponentLineDestaqueFalse),oe=c(()=>G().getComponentLineDestaqueTrue),se=c(()=>!!r.fields.value.filter(({destaque:t})=>t).length),ne=c(()=>p.value>70?"col-12":p.value>50?"col-6":p.value>30?"col-4":"col-3"),le=c(()=>p.value>60?"col-4":p.value>40?"col-6":"col-12"),ie=c(()=>[{header:0,title:"Dados do Arquivo",havePermission:!0,openItem:!0},{header:1,title:"Dados do Lote",havePermission:!0,openItem:!0},D.value?{header:2,title:i.value?"Alterar":"Cadastrar",havePermission:!0,expandItem:!0,bgColor:"#d6f2de"}:{},i.value?{}:{header:3,title:"Listagem",havePermission:!0,openItem:!0}]);async function re(t,a){a&&(_().idAverbacao=a),i.value=t;const e=await n.get_release_line_by_id(t);_().setValues(n.getValoresFormatSelect(r.fields.value,n.getReduceValores(e)))}function de(t){const a=()=>{n.delete_line(t).then(()=>{x(g.pagination),F()})};n.confirmDialog(a,{message:k("message.deleted_line_do_you_want_to_continue")})}async function x(t){await qe.get_table_line(t,q)}async function L(){i.value&&E(),i.value=void 0,await x(),await F()}function T(){Y(te.value).then(({idAverbacao:t,...a})=>{const{pagination:{rowsNumber:e}}=g,m=i.value?void 0:(e||0)+1,d=new $e({idSecaoPai:q,numeroSecao:m,idAverbacao:t,valores:a});if(i.value){n.put_line({...d,id:i.value}).then(()=>L());return}n.post_line(d).then(()=>L())})}function A(){N(),_().idAverbacao=void 0}function ue(){A(),n.goBack(),g.$reset()}async function F(){V&&await n.get_release_file_by_id(V).then(t=>I.value=t),q&&await n.get_release_batch_by_id(q).then(t=>{const a=t.filter((e,m,d)=>{if(e.nome.trim()==="Tipo de registro")return!1;if(e.nome.trim()==="Número de lote"){const w=d.findIndex(me=>me.nome.trim()==="Número de lote");return m!==w}return!0});S.value=a})}return _e(()=>{A(),g.$reset()}),pe(r.idAverbacao,async t=>{t&&(N(),await K.getEndoresementById(t).then(a=>ee(n.getReduceValores(a.campos,"idValor"))),E(_()))}),ge(async()=>{B.value=await K.getEndoresementList();const t=await xe.get_colum_table_line();R.value.push(...t),await n.get_list_field_line(),Z(),F(),se||(p.value=0)}),(t,a)=>(u(),h(o(ke),{container:ie.value,title:o(X),"sub-title":o(W)},{"right-top":l(()=>[s(f,{color:"grey-8",type:"submit",label:t.$t("message.close"),onClick:a[0]||(a[0]=e=>o(n).go_to("HOME"))},null,8,["label"])]),section0:l(()=>[s(O,{values:I.value},null,8,["values"])]),section1:l(()=>[s(O,{values:S.value},null,8,["values"])]),section2:l(()=>[s(ye,{greedy:"",onSubmit:he(T,["prevent"])},{default:l(()=>[v("div",null,[v("div",Le,[s(De,{class:"q-mb-lg",event:o(r).idAverbacao.value,"onUpdate:event":a[1]||(a[1]=e=>o(r).idAverbacao.value=e),input:{valores:B.value,field:o(r).idAverbacao.value,nome:t.$t("message.endorsementType"),obrigatorio:!1,fieldAttrs:o(r).idAverbacaoAttrs.value},errors:o(r).errors.value.idAverbacao},null,8,["event","input","errors"])]),o(r).fields.value.filter(({destaque:e})=>e).length?(u(),h(J,{key:0,title:"Destaque",class:"q-mx-md","header-highlights":""},{slot:l(()=>[v("div",Te,[(u(!0),y(z,null,U(o(r).fields.value.filter(({destaque:e})=>e),(e,m)=>{var d;return u(),y("div",{class:Q([le.value,"col-12 col-md-3 q-mt-sm"]),key:e.id},[(u(),h(j((d=oe.value)==null?void 0:d[m]),{event:e.field,"onUpdate:event":w=>e.field=w,input:{...e,valores:o(n).formatToListTValor(e.valores,"id","valor","descricao")},errors:o(r).errors.value[e.id]},null,40,["event","onUpdate:event","input","errors"]))],2)}),128))])]),_:1})):C("",!0),s(J,{title:"Conteúdo",class:"q-mx-md",style:{"margin-top":"40px"},"header-highlights":""},{slot:l(()=>[v("div",Ae,[(u(!0),y(z,null,U(o(r).fields.value.filter(({destaque:e})=>!e),(e,m)=>{var d;return u(),y("div",{class:Q(ne.value),key:e.id},[(u(),h(j((d=ae.value)==null?void 0:d[m]),{event:e.field,"onUpdate:event":w=>e.field=w,input:{...e,valores:o(n).formatToListTValor(e.valores,"id","valor","descricao")},errors:o(r).errors.value[e.id]},null,40,["event","onUpdate:event","input","errors"]))],2)}),128))])]),_:1})]),i.value?C("",!0):(u(),y("div",Fe,[s(f,{color:"grey-8",class:"q-mr-md",label:o(k)("message.clear"),onClick:a[2]||(a[2]=e=>A())},null,8,["label"]),s(f,{color:"primary",type:"submit",class:"q-mr-md"},{default:l(()=>[s(M,{name:"fa-solid fa-plus",left:"",size:"xs"}),v("span",{textContent:P(t.$t("message.add"))},null,8,Ve)]),_:1})]))]),_:1})]),section3:l(()=>[!D.value&&!i.value?(u(),y("div",Be,[s(f,{color:"primary",onClick:T},{default:l(()=>[s(M,{name:"fa-solid fa-plus",left:"",size:"xs"}),v("span",{textContent:P(t.$t("message.add"))},null,8,Re)]),_:1})])):C("",!0),s(Ce,{col:R.value,rows:o(g).get_list,pagination:o(g).pagination,request:x,"have-actions":!0},{default:l(({action:{row:{id:e,idAverbacao:m}}})=>[D.value?(u(),h(f,{key:0,icon:"fa-solid fa-pen",flat:"",size:"sm",round:"",color:"grey-8",onClick:d=>re(e,m)},{default:l(()=>[s(H,{data:"Alterar Linha"})]),_:2},1032,["onClick"])):C("",!0),s(f,{icon:"fa-solid fa-trash",flat:"",size:"sm",round:"",color:"grey-8",onClick:d=>de(e)},{default:l(()=>[s(H,{data:"Remover Linha"})]),_:2},1032,["onClick"])]),_:1},8,["col","rows","pagination"])]),"after-inner-page":l(()=>[v("div",Ie,[s(f,{label:t.$t("message.cancel"),color:"grey-8",onClick:a[3]||(a[3]=e=>i.value?L():ue())},null,8,["label"]),i.value?(u(),h(f,{key:0,label:t.$t("message.confirm"),color:"primary",onClick:a[4]||(a[4]=e=>T())},null,8,["label"])):C("",!0)])]),_:1},8,["container","title","sub-title"]))}});export{Ye as default};
