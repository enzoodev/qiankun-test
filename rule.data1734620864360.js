var C=Object.defineProperty;var O=(o,a,e)=>a in o?C(o,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[a]=e;var _=(o,a,e)=>O(o,typeof a!="symbol"?a+"":a,e);import{i as b,B as A,M as R,N as p,O as L,P as B}from"./index1734620864360.js";import{u as N}from"./field.service1734620864360.js";import{p as D}from"./pagination-store.util1734620864360.js";import{R as E}from"./rule-enum1734620864360.js";import{d as V,w as h,B as q,D as M}from"./index17346208643602.js";import{a as $}from"./field.data1734620864360.js";const{t:w}=b.global,j=A("rule-search-form-store",()=>{const o=R().shape({campo:p().notRequired().label(w("message.field")),valorCampo:p().notRequired().label(w("message.fieldValue")),tipoRegra:p().notRequired().label(w("message.ruleTypeLabel"))}),{defineField:a,errors:e,resetForm:r,values:t}=N({validationSchema:o}),[s,i]=a("campo"),[l,d]=a("valorCampo"),[n,v]=a("tipoCampo"),[I,S]=a("tipoRegra");return{valorCampoAttrs:d,valorCampo:l,campo:s,campoAttrs:i,tipoRegra:I,tipoRegraAttrs:S,tipoCampo:n,tipoCampoAttrs:v,errors:e,values:t,resetForm:r}}),H=D("useRulesTableStore"),{t:c}=b.global,x=A("rule-manage-form-store",()=>{const o=R().shape({campo:p().required().label(c("message.field")),valorCampo:p().required().label(c("message.fieldValue")),tipoRegra:p().required().label(c("message.ruleTypeLabel")),camposImpactados:L().required().min(1).of(B((u,T)=>{const g=T.from;return g&&g[g.length-1].value.tipoRegra===E.PREENCHIMENTO?R().shape({campoImpactado:p().required().label(c("message.field")),valorPreenchimento:R().shape({id:p().required().label(c("message.fieldValue"))})}):R().shape({campoImpactado:p().required().label(c("message.field"))})})).label(c("message.fieldsToPutRules"))}),{defineField:a,setFieldValue:e,resetForm:r,validate:t,setValues:s,errors:i,values:l}=N({validationSchema:o,initialValues:{camposImpactados:[]}}),[d,n]=a("campo"),[v,I]=a("valorCampo"),[S,P]=a("tipoRegra"),[F]=a("camposImpactados");return{valorCampoAttrs:I,valorCampo:v,campo:d,campoAttrs:n,tipoRegra:S,tipoRegraAttrs:P,impactedFields:F,values:l,errors:i,setValues:s,resetForm:r,validateFn:async()=>{const{valid:u}=await t({mode:"force"});if(u)return l;throw V.createNotify(c("message.invalid_form"),"warning"),new Error(c("message.invalid_form"))},addImpactedField:u=>{e("camposImpactados",[...F.value,u])},deleteImpactedField:u=>{e("camposImpactados",F.value.filter((T,g)=>g!==u))}}});var G=Object.defineProperty,U=Object.getOwnPropertyDescriptor,y=(o,a,e,r)=>{for(var t=U(a,e),s=o.length-1,i;s>=0;s--)(i=o[s])&&(t=i(a,e,t)||t);return t&&G(a,e,t),t};class m{constructor(a){this.apiService=a}async getAllRules({page:a,rowsPerPage:e,order:r,sortBy:t},s){return this.apiService.override_url(`${a}-${e}`),await this.apiService.find_all({params:{order:r,sortBy:t,...s}})}async getRuleById(a){return await this.apiService.find_by_id(a)}async saveRule(a){return await this.apiService.save({...a,auditProject:"DEP"})}async updateRule({id:a,...e}){return await this.apiService.update({...e,auditProject:"DEP"},a)}async deleteRule(a){return this.apiService.override_url("delete"),await this.apiService.update({sgProjetoModificador:"DEP",sgAcaoModificadora:"DELREG",noEndpointModificador:this.apiService._url()},a)}}y([h({group:"getAllRules"})],m.prototype,"getAllRules");y([h({group:"getRuleById"})],m.prototype,"getRuleById");y([h({group:"saveRule"})],m.prototype,"saveRule");y([h({group:"updateRule"})],m.prototype,"updateRule");y([h({group:"deleteRule"})],m.prototype,"deleteRule");const f=new m(new q("https://dev.gerais.mg.def.br","depe/service".concat("/regra")));class W extends M{constructor(){super(...arguments);_(this,"store",x())}async getAllRules(e){const{pagination:r,SET_TOTAL_ROWS:t,SET_PAGINATION:s,SET_LIST:i}=H(),l=j().values;return s(e),await f.getAllRules(r,l).then(({dados:d,totalRegistros:n})=>(t(n),i(d),d))}async getFieldValuesListByFieldIdsList({camposImpactados:e}){if(!e)return[];const r=e.map(({campoImpactado:t})=>t);return await $.getFieldValuesListByFieldIdsList(r).then(({dados:t})=>t)}async formatImpactedFields(e){var s;const r=e.tipoRegra===E.PREENCHIMENTO,t=await this.getFieldValuesListByFieldIdsList({camposImpactados:e.camposImpactados});return((s=e.camposImpactados)==null?void 0:s.map(({campoImpactado:i,valorPreenchimento:l})=>{const d=(t==null?void 0:t.filter(({campo:v})=>v===i))??[],n=super.formatToListTValor(d,"valor","descricao");return{campoImpactado:i.toString(),valorPreenchimento:{id:(l==null?void 0:l.valor)??""},valueOptions:r?n:void 0}}))??[]}async getRuleById(e){const{dados:r}=await f.getRuleById(e);if(!r){this.createNotify(this.t("message.ruleNotFound"),"warning"),super.goBack();return}const t=await this.formatImpactedFields(r);this.store.setValues({...r,camposImpactados:t})}formatDataToSave(e){const r=e.tipoRegra===E.PREENCHIMENTO;return{...e,camposImpactados:e.camposImpactados.map(({campoImpactado:t,valorPreenchimento:s})=>({campoImpactado:t,valorPreenchimento:r?s:void 0}))}}async saveRule(e){return await f.saveRule(this.formatDataToSave(e)).then(({mensagem:r})=>this.createNotify(r,"positive"))}async updateRule(e){return await f.updateRule(this.formatDataToSave(e)).then(({mensagem:r})=>this.createNotify(r,"positive"))}async deleteRule(e){return await f.deleteRule(e).then(({mensagem:r})=>this.createNotify(r,"positive"))}}const te=new W;export{te as d,j as r,H as u};
