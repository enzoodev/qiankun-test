var _=Object.defineProperty;var P=(h,e,t)=>e in h?_(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var c=(h,e,t)=>P(h,typeof e!="symbol"?e+"":e,t);import{m as V,u as k}from"./field.service1734620864360.js";import{V as B,d as R}from"./index17346208643602.js";import{r as H,M as b,N as q,i as D,B as G,c as M,v as j}from"./index1734620864360.js";import{R as z}from"./rule-enum1734620864360.js";class J{constructor(){c(this,"shape",{});c(this,"fields",H([]));c(this,"schema",{});c(this,"validationByRuleType",{OBRIGATORIO:({id:e},{campo:t,valorCampo:i,nomeCampo:a,tipoRegra:s})=>{const n=this;if(e)return this.shape[e].test({name:s,message:`Este campo é obrigatório quando ${a} tiver este valor.`,test:function(r){return n.updateField(e,this.parent[t]),this.parent[t]!=i||!!r}})},PREENCHIMENTO:({id:e},{campo:t,descricaoValor:i,tipoRegra:a})=>{const s=this;if(e)return this.shape[e].test({name:a,message:`Este campo deve ser preenchido com ${i}.`,test:function(){return s.updateField(e,this.parent[t]),!0}})},PROIBIDO:({id:e},{campo:t,valorCampo:i,tipoRegra:a,nomeCampo:s})=>{const n=this;if(e)return this.shape[e].test({name:a,message:`Este campo será proibido quando ${s} tiver esse valor.`,test:function(r){return n.updateField(e,this.parent[t],"proibido"),!(this.parent[t]==i&&r)}})},OPCIONAL:({id:e},t)=>this.shape[e]})}updateField(e,t,i="obrigatorio"){var n;const a=this.fields.value.findIndex(r=>r.id==e);if(a<0)return;const s=!!((n=this.fields.value[a].regras)!=null&&n.filter(({valorCampo:r,tipoRegra:d})=>t==r&&d.toLowerCase()===i).length);i==="proibido"&&this.fields.value[a].field!=null&&s&&(this.fields.value[a].field=void 0),this.fields.value[a][i]=s}createValidationSchema(e){return e.length?(e.forEach(t=>{const{tipoValor:i,nome:a,id:s,quantidadeCaracteres:n,obrigatorio:r,regras:d}=t;s&&(this.shape[s]=q().label(a),this.shape[s]=this.shape[s].notRequired(),r&&(this.shape[s]=this.shape[s].required()),i===B.NUMERICO&&(this.shape[s]=this.shape[s].matches(/^\d+$/,"Este campo deve conter apenas números.")),n&&i!==B.SELECAO&&(this.shape[s]=this.shape[s].max(n)),d!=null&&d.length&&d.forEach(m=>{const{tipoRegra:F}=m;this.shape[s]=this.validationByRuleType[F](t,m)}))}),b().shape(this.shape)):b()}}const S=D.global.t;class Z extends J{constructor(t){super();c(this,"typeField");c(this,"nameStoreBase","FORM-STORE-");this.typeField=t}createStore(){return G(this.nameStoreBase+this.typeField,()=>{this.schema=M(()=>this.createValidationSchema(V()[this.typeField]).concat(b().shape({idAverbacao:q().notRequired().label(S("message.endorsementType"))})));const{defineField:t,setFieldValue:i,validate:a,resetForm:s,setValues:n,values:r,errors:d,resetField:m}=k({validationSchema:this.schema}),F=()=>{this.fields.value=V()[this.typeField].map(o=>{const{id:p,tipoValor:l,quantidadeCaracteres:f}=o,[u,g]=t(String(p));return{...o,field:u,fieldAttrs:g,mask:R.createMaks(f,l)??void 0}})},w=()=>{this.fields.value.forEach(({id:o})=>{m(String(o),{value:void 0})})},[U,$]=t("idAverbacao"),x=()=>{this.fields.value.length&&this.fields.value.forEach(({regras:o,id:p,valores:l})=>{const f=o==null?void 0:o.filter(({tipoRegra:u})=>u===z.PREENCHIMENTO);f!=null&&f.length&&f.forEach(({campo:u,valorCampo:g,valorPreenchimento:y})=>{if(!y)return;const T=M(()=>{var E;return(E=this.fields.value.find(({id:O})=>O==u))==null?void 0:E.field});j(T,E=>{var A,C,N,I;((N=(C=(A=this.fields.value.find(({id:v})=>v==u))==null?void 0:A.valores)==null?void 0:C.find(({id:v})=>v===E))==null?void 0:N.valor)==g&&i(String(p),(I=l==null?void 0:l.find(({valor:v})=>v==y))==null?void 0:I.id)},{deep:!0})})})},L=async o=>{const{valid:p}=await a({mode:"force"}),l=o||S("message.invalid_form");if(p)return{idAverbacao:r.idAverbacao,...R.formatValuesForNewRelease(this.fields.value)};throw R.createNotify(l,"warning"),new Error(S("message.invalid_form"))};return{fields:this.fields,schema:this.schema,values:r,errors:d,idAverbacao:U,idAverbacaoAttrs:$,filling:x,resetForm:s,setValues:n,validateFn:L,resetField:m,resetFields:w,createFields:F,setFieldValue:i}})}}export{Z as F};
