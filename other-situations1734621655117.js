import{a as ce,h as me,N as Z,t as pe,c as $,v as be,r as ee,x as ve,z as ye,C as G,D as t,E as a,H as e,X as ge,y as fe,A as he,B as x,S as H,Q as N,W as E,K as F,F as l,G as _e,M as B,O as V,J as U,I as Ue,V as K}from"./index1734621655117.js";import{b as oe,c as Se,d as J,e as Y,g as Ne,h as W}from"./vee-validate1734621655117.js";import{u as Pe,c as Te,Q as Ie,a as Oe,r as xe,b as L,d as z,L as Ce}from"./rowPerPageOptions1734621655117.js";import{i as Re,_ as we}from"./isValid1734621655117.js";import{u as Ee}from"./useGetInventoryStatus1734621655117.js";import{p as te,u as Fe}from"./patrimonyOtherSituationService1734621655117.js";import{b as Ve,u as ke}from"./unitService1734621655117.js";import{u as j,Q as k,a as Ae,t as Qe}from"./index17346216551174.js";import{F as qe}from"./FileSaver.min1734621655117.js";import{f as Me}from"./formatDateTime1734621655117.js";import"./QSkeleton1734621655117.js";import"./auditProject1734621655117.js";const Le=ce({name:"QSpace",setup(){const r=me("div",{class:"q-space"});return()=>r}}),De=({handleSubmit:r,closeModal:n})=>{const i=j(),{mutateAsync:v,isPending:d}=oe({mutationFn:u=>te.exportInventoryOtherSituations(u)});return{exportInventoryOtherSituations:r(async u=>{const g=await v(u);qe.saveAs(g,"INVENTARIO_OUTRAS_SITUACOES.xlsx"),Z.create({message:"O relatório XLSX foi gerado.",color:"positive"}),i.invalidateQueries({queryKey:[k.GET_INVENTORY_STATUS]}),n()},()=>{n()}),isPendingExportInventoryOtherSituations:d}},Ge=Se().shape({numeroPatrimonio:J().nullable().typeError("Número do Patrimônio deve ser um número").test("patrimony-or-others","Preencha o N° Patrimônio ou os outros campos, mas não ambos",function(r){const{situacao:n,codUnidadeResponsavel:i,nomeUnidadeResponsavel:v,descricaoItemMaterial:d}=this.parent,y=n||i||v||d;return r?!y:!0}),situacao:Y().nullable(),codUnidadeResponsavel:J().nullable(),nomeUnidadeResponsavel:Y().nullable(),descricaoItemMaterial:Y().nullable()}),He=pe("useGetPatrimonyOtherSituationListStore",()=>{const r=Pe(),{handleSubmit:n,errors:i,resetForm:v,defineField:d,setFieldValue:y}=Ne({validationSchema:Ge,initialValues:r.data.value}),[u,g]=d("numeroPatrimonio"),[S,o]=d("situacao"),[h,P]=d("codUnidadeResponsavel"),[T,_]=d("nomeUnidadeResponsavel"),[I,s]=d("descricaoItemMaterial"),m=$(()=>[u.value,S.value,h.value,T.value,I.value].some(Re)),C=()=>{y("nomeUnidadeResponsavel",void 0)},R=f=>{y("codUnidadeResponsavel",f)},O=n(f=>{r.setFormData(f)});return{search:r,errors:i,hasFilters:m,handleSubmit:n,patrimonyNumber:u,status:S,responsibleUnitCode:h,responsibleUnitName:T,description:I,patrimonyNumberProps:g,statusProps:o,responsibleUnitCodeProps:P,responsibleUnitNameProps:_,descriptionProps:s,onSubmit:O,resetForm:v,onChangeUnitCode:C,onChangeUnitName:R}}),Be=()=>{const{invalidateQueries:r}=j(),n=He(),{search:i,onSubmit:v,handleSubmit:d,resetForm:y,onChangeUnitCode:u,onChangeUnitName:g}=n,{errors:S,hasFilters:o,patrimonyNumber:h,status:P,responsibleUnitCode:T,responsibleUnitName:_,description:I,patrimonyNumberProps:s,statusProps:m,responsibleUnitCodeProps:C,responsibleUnitNameProps:R,descriptionProps:O}=be(n),f=$(()=>({...i.data,nomeUnidadeResponsavel:void 0,page:i.pagination.page,rowsPerPage:i.pagination.rowsPerPage})),{isFetching:D,data:w}=Ae({queryKey:[k.GET_PATRIMONY_OTHER_SITUATION_LIST,f],queryFn:async()=>{const Q=await te.getAll(f.value);return i.setRowsNumber(Q.total),Q}}),A=()=>{y(),i.reset(),r({queryKey:[k.GET_PATRIMONY_OTHER_SITUATION_LIST],exact:!0})};return{data:w,isFetching:D,handleSubmit:d,hasFilters:o,errors:S,pagination:i.pagination,setPagination:i.setPagination,onSubmit:v,reset:A,form:{patrimonyNumber:h,status:P,responsibleUnitCode:T,responsibleUnitName:_,description:I,patrimonyNumberProps:s,statusProps:m,responsibleUnitCodeProps:C,responsibleUnitNameProps:R,descriptionProps:O,onChangeUnitCode:u,onChangeUnitName:g}}},Ke=()=>{const r=j(),n=ee(0),{mutateAsync:i,isPending:v}=oe({mutationFn:u=>Ve.deleteOtherSituation(u)}),d=async u=>{n.value=u;const g=await i(u);Z.create({message:g,color:"positive"}),r.invalidateQueries({queryKey:[k.GET_PATRIMONY_OTHER_SITUATION_LIST]}),r.invalidateQueries({queryKey:[k.GET_PATRIMONY_OTHER_SITUATION_BY_ID,{id:u}]})},y=$(()=>({id:n.value,isPending:v.value}));return{deleteOtherSituation:d,pendingDeleteOtherSituation:y}},Ye=(r,n)=>{var i;return((i=n==null?void 0:n.find(v=>v.value===r))==null?void 0:i.label)??r},ze={class:"row q-col-gutter-md q-mt-sm"},$e={class:"col-lg-3 col-sm-6 col-xs-12"},je={class:"col-lg-9 col-sm-12 col-xs-12"},Xe={class:"row q-col-gutter-md q-mt-sm"},Je={class:"col-lg-3 col-sm-6 col-xs-12"},We={class:"col-lg-3 col-sm-6 col-xs-12"},Ze={class:"col-lg-6 col-sm-12 col-xs-12"},eo={class:"flex justify-end q-mt-lg"},oo={class:"q-mt-lg"},to={class:"flex row items-center justify-between full-width"},so={class:"text-subtitle2"},ao={style:{overflow:"hidden","white-space":"collapse","text-overflow":"ellipsis"}},no={style:{overflow:"hidden","white-space":"collapse","text-overflow":"ellipsis"}},io={style:{overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},lo={key:0,class:"q-gutter-xs"},ro={class:"full-width row flex-center text-grey-7"},uo=["textContent"],co={key:0,class:"flex justify-end q-mt-xl"},Po=ve({__name:"other-situations",setup(r){const{path:n,params:i,meta:v}=fe(),d=n.includes("comissao"),y=n.includes("unidade"),u=i.fromHome==="true",{title:g,subtitle:S}=v,{t:o}=ye.global,h=ee(!1),P=()=>{h.value=!1},{data:T,isFetching:_,pagination:I,form:s,errors:m,hasFilters:C,handleSubmit:R,setPagination:O,onSubmit:f,reset:D}=Be(),{inventoryPermissions:w}=Ee(),{situations:A,isFetchingSituations:Q}=Fe(),{responsibleUnities:se,isFetchingResponsibleUnities:ae,filterResponsibleUnitiesFn:ne}=ke(),{pendingDeleteOtherSituation:q,deleteOtherSituation:ie}=Ke(),{isPendingExportInventoryOtherSituations:le,exportInventoryOtherSituations:re}=De({handleSubmit:R,closeModal:P}),de=Te([{key:"situacao",label:o("situation")},{key:"numeroPatrimonio",label:o("patrimonyNumberLabel")},{key:"codUnidadeResponsavel",label:o("responsibleUnityCodeLabel")},{key:"nomeUnidadeResponsavel",label:o("responsibleUnity")},{key:"descricao",label:o("description")},{key:"createdDate",label:o("dateAndHour"),fn:X=>Me(X,{showTime:!0})},{key:"autorObservacoes",label:o("observationsAuthor")},w.value.canSetData?{key:"acao",label:o("action")}:void 0]),ue=[{header:0,title:o("search"),havePermission:!0,expandItem:!0}];return(X,c)=>{const M=he("router-link");return x(),G(ge,null,[t(e(Qe),{container:ue,title:e(g),"sub-title":e(S)},{"right-top":a(()=>[e(d)?(x(),H(M,{key:0,to:{name:e(E).HOME}},{default:a(()=>[t(N,{color:"grey-8",label:e(o)("close")},null,8,["label"])]),_:1},8,["to"])):F("",!0),e(w).canSetData&&e(y)?(x(),H(M,{key:1,to:{name:e(E).UNIT_CREATE_OTHER_SITUATION}},{default:a(()=>[t(N,{icon:"add",color:"primary",label:e(o)("new")},null,8,["label"])]),_:1},8,["to"])):F("",!0)]),section0:a(()=>[l("div",null,[l("form",{novalidate:"",onSubmit:c[5]||(c[5]=_e((...p)=>e(f)&&e(f)(...p),["prevent"]))},[l("div",ze,[l("div",$e,[t(B,V({modelValue:e(s).responsibleUnitCode.value,"onUpdate:modelValue":c[0]||(c[0]=p=>e(s).responsibleUnitCode.value=p)},e(s).responsibleUnitCodeProps.value,{error:!!e(m).codUnidadeResponsavel,"error-message":e(m).codUnidadeResponsavel,disable:!!e(s).patrimonyNumber.value,"no-error-icon":"",dense:"",clearable:"","clear-icon":"close","emit-value":"","map-options":"",label:e(o)("responsibleUnityCodeLabel"),type:"number"}),null,16,["modelValue","error","error-message","disable","label"])]),l("div",je,[t(W,V({modelValue:e(s).responsibleUnitName.value,"onUpdate:modelValue":c[1]||(c[1]=p=>e(s).responsibleUnitName.value=p)},e(s).responsibleUnitNameProps.value,{options:e(se),error:!!e(m).nomeUnidadeResponsavel,"error-message":e(m).nomeUnidadeResponsavel,loading:e(ae),disable:!!e(s).patrimonyNumber.value||!!e(s).responsibleUnitCode.value,dense:"","map-options":"","emit-value":"",clearable:"","clear-icon":"close","use-input":"","input-debounce":0,onFilter:e(ne),label:e(o)("responsibleUnity"),"option-value":"codUnidadeResponsavel","option-label":"nomeUnidadeResponsavel","onUpdate:modelValue":e(s).onChangeUnitName}),null,16,["modelValue","options","error","error-message","loading","disable","onFilter","label","onUpdate:modelValue"])])]),l("div",Xe,[l("div",Je,[t(B,V({modelValue:e(s).patrimonyNumber.value,"onUpdate:modelValue":c[2]||(c[2]=p=>e(s).patrimonyNumber.value=p)},e(s).patrimonyNumberProps.value,{"no-error-icon":"",error:!!e(m).numeroPatrimonio,"error-message":e(m).numeroPatrimonio,dense:"",clearable:"","clear-icon":"close","emit-value":"","map-options":"",label:e(o)("patrimonyNumber"),type:"number"}),null,16,["modelValue","error","error-message","label"])]),l("div",We,[t(W,V({modelValue:e(s).status.value,"onUpdate:modelValue":c[3]||(c[3]=p=>e(s).status.value=p)},e(s).statusProps.value,{options:e(A),error:!!e(m).situacao,"error-message":e(m).situacao,loading:e(Q),disable:!!e(s).patrimonyNumber.value,dense:"","map-options":"","emit-value":"",clearable:"","clear-icon":"close",label:e(o)("situation")}),null,16,["modelValue","options","error","error-message","loading","disable","label"])]),l("div",Ze,[t(B,V({modelValue:e(s).description.value,"onUpdate:modelValue":c[4]||(c[4]=p=>e(s).description.value=p)},e(s).descriptionProps.value,{error:!!e(m).descricaoItemMaterial,"error-message":e(m).descricaoItemMaterial,disable:!!e(s).patrimonyNumber.value,"no-error-icon":"",dense:"",clearable:"","clear-icon":"close","emit-value":"","map-options":"",label:e(o)("description")}),null,16,["modelValue","error","error-message","disable","label"])])]),l("div",eo,[t(N,{disable:e(_),label:e(o)("clear"),class:"q-mr-sm",color:"grey-8",onClick:e(D)},null,8,["disable","label","onClick"]),t(N,{disable:e(_),label:e(o)("search"),color:"primary",icon:"search",type:"submit"},null,8,["disable","label"])])],32),l("div",oo,[t(Ie,{class:"bg-grey-3 rounded-borders shadow-1","expand-icon-toggle":"","default-opened":""},{header:a(()=>[l("div",to,[l("span",so,U(e(o)("listing")),1),t(Le),e(d)&&e(w).canExport?(x(),H(Ue,{key:0,name:"fa fa-file-excel",size:"sm",class:"cursor-pointer q-mr-md",color:"primary",onClick:c[6]||(c[6]=()=>h.value=!0)})):F("",!0)])]),default:a(()=>{var p;return[l("div",null,[t(Oe,{columns:e(de),rows:((p=e(T))==null?void 0:p.list)??[],"rows-per-page-options":e(xe),class:"shadow-0","row-key":"id",loading:e(_),"hide-no-data":e(_),pagination:e(I),onRequest:c[7]||(c[7]=b=>e(O)(b.pagination)),"onUpdate:pagination":e(O)},{"body-cell-situacao":a(({row:b})=>[t(L,{style:{width:"31rem"}},{default:a(()=>[l("div",ao,U(e(Ye)(b.situacao,e(A))),1)]),_:2},1024)]),"body-cell-nomeUnidadeResponsavel":a(({row:b})=>[t(L,{style:{width:"31rem"}},{default:a(()=>[l("div",no,U(b.nomeUnidadeResponsavel),1)]),_:2},1024)]),"body-cell-descricao":a(({row:b})=>[t(L,{style:{"max-width":"31rem"}},{default:a(()=>[l("div",io,U(b.descricao),1),t(z,{style:{width:"25rem"}},{default:a(()=>[K(U(b.descricao),1)]),_:2},1024)]),_:2},1024)]),"body-cell-acao":a(({row:b})=>[t(L,null,{default:a(()=>[b.situacaoCadastroManual?(x(),G("div",lo,[t(M,{to:{name:e(E).UNIT_UPDATE_OTHER_SITUATION,params:{id:b.id.toString()}}},{default:a(()=>[t(N,{color:"grey-8",flat:"",icon:"fa fa-pencil",round:"",size:"sm"},{default:a(()=>[t(z,null,{default:a(()=>[K(U(e(o)("update")),1)]),_:1})]),_:1})]),_:2},1032,["to"]),t(N,{color:"grey-8",flat:"",icon:"fa fa-trash",round:"",size:"sm",loading:e(q).isPending&&e(q).id===b.id,disable:e(q).isPending&&e(q).id!==b.id,onClick:()=>e(ie)(b.id)},{default:a(()=>[t(z,null,{default:a(()=>[K(U(e(o)("delete")),1)]),_:1})]),_:2},1032,["loading","disable","onClick"])])):F("",!0)]),_:2},1024)]),loading:a(()=>[t(Ce)]),"no-data":a(()=>[l("div",ro,[l("span",{textContent:U(e(o)("noRecordsFound"))},null,8,uo)])]),_:1},8,["columns","rows","rows-per-page-options","loading","hide-no-data","pagination","onUpdate:pagination"])])]}),_:1})]),e(y)?(x(),G("div",co,[t(M,{to:{name:u?e(E).HOME:e(E).UNIT}},{default:a(()=>[t(N,{color:"grey-8",label:e(o)("cancel")},null,8,["label"])]),_:1},8,["to"])])):F("",!0)])]),_:1},8,["title","sub-title"]),t(we,{"is-open-ref":h.value,"is-pending-export":e(le),"is-other-situations":!0,"has-filters":e(C),onClose:P,onConfirm:e(re)},null,8,["is-open-ref","is-pending-export","has-filters","onConfirm"])],64)}}});export{Po as default};
